var app = angular.module('grafffApp', [
  'ngAnimate',
  'ngRoute',
  'ngResource',
  'ngMap'
]);

app.config(['$routeProvider', function($routeProvider){

  $routeProvider
  .when('/', {
    controller: 'HomeController',
    templateUrl: "<%= asset_path('views/index.html') %>"
  })
  .when('/users/:id/profile', {
    controller: 'UserController',
    templateUrl: "<%= asset_path('views/user-profile.html') %>"
  })
  .when('/artworks/:id', {
    controller: 'ArtworkController',
    templateUrl: "<%= asset_path('views/artwork.html') %>"
  })
  .otherwise({
    redirectTo: '/'
  });

}]);

app.directive('file', function() {
  return {
    restrict: 'AE',
    scope: {
      file: '@'
    },
    link: function(scope, el, attrs){
      el.bind('change', function(event){
        var files = event.target.files;
        var file = files[0];
        scope.file = file;
        scope.$parent.file = file;
        scope.$apply();
      });
    }
  };
});

app.directive('myProfileLink', function() {

  return {
    restrict: 'E',
    templateUrl: "<%= asset_path('directives/my-profile-link.html') %>",
    controller: function($scope, $http, UserFactory) {
      UserFactory.getCurrentUser().then(function(response) {
        $scope.currentUser = response.data;
      });
    }
  };

});

app.directive('artistArtworkMap', function() {
  
  return {
    restrict: 'E',
    templateUrl: "<%= asset_path('directives/artist-artwork-map.html') %>",
    controller: 'UserController'
  };

});

app.directive('newArtworkForm', function() {

  return {
    restrict: 'E',
    templateUrl: "<%= asset_path('directives/new-artwork-form.html') %>",
    controller: 'ProfileController'
  }

});